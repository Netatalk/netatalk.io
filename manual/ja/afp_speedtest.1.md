# 名前

afp_speedtest — シンプルなAFPファイル転送ベンチマークツール

# 概要

**afp_speedtest** [-1234567aeiLnVvy] [-h *host*] [-p *port*] [-s *volume*] [-S *volume2*] [-u *user*]
[-w *password*] [-n *iterations*] [-d *size*] [-q *quantum*] [-F *file*] [-f *test*]

# 説明

**afp_speedtest** は、読み取り、書き込み、コピー操作のための AFP ベンチマークテストスイートである。
AFP コマンドまたは POSIX システムコールを使用して実行でき、netatalk の速度を他のファイル転送プロトコルと比較するのに便利だ。

# オプション

**-1**
: AFP 2.1プロトコルバージョンを使用する

**-2**
: AFP 2.2プロトコルバージョンを使用する

**-3**
: AFP 3.0プロトコルバージョンを使用する

**-4**
: AFP 3.1プロトコルバージョンを使用する

**-5**
: AFP 3.2プロトコルバージョンを使用する

**-6**
: AFP 3.3プロトコルバージョンを使用する

**-7**
: AFP 3.4プロトコルバージョンを使用する

**-a**
: 書き込み後にディスクにフラッシュしない

**-d** *size*
: ファイルサイズ (MB、デフォルト: 64)

**-D**
: openフラグで O_DIRECT を使用する（POSIX モードの場合）

**-e**
: スパースファイルを使用する

**-f** *テスト*
: 実行する特定のテスト (Read, Write, Copy, ServerCopy, デフォルト: Write)

**-F** *ファイル*
: ボリュームのルートフォルダ内のファイルから読み取る（デフォルト: 一時ファイルを作成する）

**-h** *host*
: サーバーのホスト名またはIPアドレス（デフォルト: localhost）

**-i**
: 対話型モード – 各テストの前にユーザーにプロンプトを表示します（デバッグに使用）

**-L**
: AFPの代わりにPOSIX呼び出しを使用する

**-n** *回数*
: 実行するテスト反復回数（デフォルト: 1）

**-p** *port*
: サーバーポート番号（デフォルト: 548）

**-q** *サイズ*
: パケットサイズ（KB、デフォルト: サーバークォンタム）

**-r** *回数*
: 未処理リクエストの数（デフォルト: 1）

**-R** *回数*
: インターリーブされていない未処理のリクエストの数（デフォルト: 1）

**-s** *ボリューム名*
: テスト用にマウントするボリューム名

**-S** *ボリューム名*
: テスト用にマウントする2番目のボリュームのボリューム名

**-u** *ユーザー名*
: 認証用のユーザー名（デフォルト: 現在のuid）

**-v**
: 詳細出力

**-V**
: 超詳細出力

**-w** *パスワード文字列*
: 認証用のパスワード

**-y**
: 実行ごとに新しいファイルを使用する（デフォルト: 同じファイル）

# 設定

テストランナーの AFP クライアントは現在 ClearTxt UAM のみをサポートしている。netatalk の afp.conf で UAM
を設定する。

    [Global]
    uam list = uams_clrtxt.so

# 例

Read,Write,Copy,ServerCopyの4つのベンチマークテストをそれぞれ5回繰り返して実行する

    $ afp_speedtest -h 10.0.0.10 -s speed1 -u myuser -w mypass -n 5 -f Read,Write,Copy,ServerCopy
    Read quantum 1048576, size 67108864 
    run	 microsec	  KB/s
    1	   251577	273154.84
    2	   222635	308664.31
    3	   226490	303410.66
    4	   228992	300095.53
    5	   220840	311173.16

    Write quantum 1048576, size 67108864
    run	 microsec	  KB/s
    1	   210057	327146.81
    2	   195791	350983.84
    3	   193921	354368.41
    4	   208458	329656.22
    5	   206792	332312.06

    Copy quantum 1048576, size 67108864 
    run	 microsec	  KB/s
    1	   418005	164398.70
    2	   392906	174900.55
    3	   400815	171449.36
    4	   392021	175295.39
    5	   390320	176059.33

    ServerCopy quantum 1048576, size 67108864 
    run	 microsec	  KB/s
    1	    20585	3338327.75
    2	    21986	3125601.50
    3	    21762	3157774.00
    4	    21913	3136014.00
    5	    20832	3298746.00

# 関連項目

**afp_lantest**(1), **afpd**(8)
