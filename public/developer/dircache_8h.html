<!-- HTML header for doxygen 1.14.0-->
<!-- modified for netatalk -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>netatalk: dircache.h File Reference</title>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<script
    src="https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js"
    integrity="sha384-o+g/BxPwhi0C3RK7oQBxQuNimeafQ3GE/ST4iT2BxVI4Wzt60SH4pq9iXVYujjaS"
    crossorigin="anonymous"
></script>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectrow">
    <div id="projectlogo">
      <a href="/"><img alt="Logo" src="logo.png"/></a>
    </div>
    <div id="projectalign">
      <div id="projectname">
        netatalk
        <span id="projectnumber">&#160;4.4.1</span>
      </div>
      <div id="projectbrief">Free and Open Source Apple Filing Protocol (AFP) Server</div>
    </div>
  </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('dircache_8h.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">dircache.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;<a class="el" href="include_2atalk_2directory_8h_source.html">atalk/directory.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="include_2atalk_2volume_8h_source.html">atalk/volume.h</a>&gt;</code><br />
</div>
<p><a href="dircache_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-define-members" class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aaf931e5979b4b527c20eac7b787a0774" id="r_aaf931e5979b4b527c20eac7b787a0774"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#aaf931e5979b4b527c20eac7b787a0774">MAX_POSSIBLE_DIRCACHE_SIZE</a>&#160;&#160;&#160;131072</td></tr>
<tr class="memitem:af4d877bd631392aad05921f5685b025a" id="r_af4d877bd631392aad05921f5685b025a"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#af4d877bd631392aad05921f5685b025a">DIRCACHE_FREE_QUANTUM</a>&#160;&#160;&#160;256</td></tr>
<tr class="memitem:a0790b0c7f16a543945bed231d4e6de90" id="r_a0790b0c7f16a543945bed231d4e6de90"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#a0790b0c7f16a543945bed231d4e6de90">DIRCACHE</a>&#160;&#160;&#160;(1 &lt;&lt; 0)</td></tr>
<tr class="memitem:a5705eb66727ef095a70ca709afd13e66" id="r_a5705eb66727ef095a70ca709afd13e66"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#a5705eb66727ef095a70ca709afd13e66">DIDNAME_INDEX</a>&#160;&#160;&#160;(1 &lt;&lt; 1)</td></tr>
<tr class="memitem:a771f8ffab86e0a3bd7bfc0e5d37bbb43" id="r_a771f8ffab86e0a3bd7bfc0e5d37bbb43"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#a771f8ffab86e0a3bd7bfc0e5d37bbb43">QUEUE_INDEX</a>&#160;&#160;&#160;(1 &lt;&lt; 2)</td></tr>
<tr class="memitem:a64c15cf04a845379b849471a4099c490" id="r_a64c15cf04a845379b849471a4099c490"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#a64c15cf04a845379b849471a4099c490">DIRCACHE_ALL</a>&#160;&#160;&#160;(<a class="el" href="#a0790b0c7f16a543945bed231d4e6de90">DIRCACHE</a>|<a class="el" href="#a5705eb66727ef095a70ca709afd13e66">DIDNAME_INDEX</a>|<a class="el" href="#a771f8ffab86e0a3bd7bfc0e5d37bbb43">QUEUE_INDEX</a>)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a32d08155545949809d026537e38bc33f" id="r_a32d08155545949809d026537e38bc33f"><td class="memItemLeft">int&#160;</td><td class="memItemRight"><a class="el" href="#a32d08155545949809d026537e38bc33f">dircache_init</a> (int reqsize)</td></tr>
<tr class="memdesc:a32d08155545949809d026537e38bc33f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the dircache and indexes.  <br /></td></tr>
<tr class="memitem:af2683959136bcfd70ba8d9157899874c" id="r_af2683959136bcfd70ba8d9157899874c"><td class="memItemLeft">int&#160;</td><td class="memItemRight"><a class="el" href="#af2683959136bcfd70ba8d9157899874c">dircache_add</a> (const struct <a class="el" href="structvol.html">vol</a> *, struct <a class="el" href="structdir.html">dir</a> *)</td></tr>
<tr class="memdesc:af2683959136bcfd70ba8d9157899874c"><td class="mdescLeft">&#160;</td><td class="mdescRight">create struct dir from struct path  <br /></td></tr>
<tr class="memitem:aa87d5fbee60bed28f7c6a2858564c230" id="r_aa87d5fbee60bed28f7c6a2858564c230"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#aa87d5fbee60bed28f7c6a2858564c230">dircache_remove</a> (const struct <a class="el" href="structvol.html">vol</a> *, struct <a class="el" href="structdir.html">dir</a> *, int <a class="el" href="netacnv_8c.html#a451d8e49e10e6d5ebb6bb73f794e3c44">flag</a>)</td></tr>
<tr class="memdesc:aa87d5fbee60bed28f7c6a2858564c230"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove an entry from the dircache.  <br /></td></tr>
<tr class="memitem:a12e124fdc2f22a4a8884a55aa251b191" id="r_a12e124fdc2f22a4a8884a55aa251b191"><td class="memItemLeft">struct <a class="el" href="structdir.html">dir</a> *&#160;</td><td class="memItemRight"><a class="el" href="#a12e124fdc2f22a4a8884a55aa251b191">dircache_search_by_did</a> (const struct <a class="el" href="structvol.html">vol</a> *<a class="el" href="structvol.html">vol</a>, <a class="el" href="adouble_8h.html#aef0c7a006ff504f92f04b55e14c27422">cnid_t</a> <a class="el" href="nad__cp_8c.html#a39466504497f1ab95465d7daf62514c1">did</a>)</td></tr>
<tr class="memdesc:a12e124fdc2f22a4a8884a55aa251b191"><td class="mdescLeft">&#160;</td><td class="mdescRight">Search the dircache via a CNID for a directory.  <br /></td></tr>
<tr class="memitem:a94141fa360d5c37d4390d3ede81e9fbd" id="r_a94141fa360d5c37d4390d3ede81e9fbd"><td class="memItemLeft">struct <a class="el" href="structdir.html">dir</a> *&#160;</td><td class="memItemRight"><a class="el" href="#a94141fa360d5c37d4390d3ede81e9fbd">dircache_search_by_name</a> (const struct <a class="el" href="structvol.html">vol</a> *, const struct <a class="el" href="structdir.html">dir</a> *<a class="el" href="structdir.html">dir</a>, char *name, size_t len)</td></tr>
<tr class="memdesc:a94141fa360d5c37d4390d3ede81e9fbd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Search the cache via did/name hashtable.  <br /></td></tr>
<tr class="memitem:a29a3f7f19ae5e4c64e1a66ccee08eb38" id="r_a29a3f7f19ae5e4c64e1a66ccee08eb38"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a29a3f7f19ae5e4c64e1a66ccee08eb38">dircache_dump</a> (void)</td></tr>
<tr class="memdesc:a29a3f7f19ae5e4c64e1a66ccee08eb38"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dump dircache to /tmp/dircache.PID.  <br /></td></tr>
<tr class="memitem:a634fc2bdbe6d1b5d9def7b568faae939" id="r_a634fc2bdbe6d1b5d9def7b568faae939"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a634fc2bdbe6d1b5d9def7b568faae939">log_dircache_stat</a> (void)</td></tr>
<tr class="memdesc:a634fc2bdbe6d1b5d9def7b568faae939"><td class="mdescLeft">&#160;</td><td class="mdescRight">Log dircache statistics.  <br /></td></tr>
<tr class="memitem:aba92d20849d1ff0a37238a15d6b7bdd0" id="r_aba92d20849d1ff0a37238a15d6b7bdd0"><td class="memItemLeft">int&#160;</td><td class="memItemRight"><a class="el" href="#aba92d20849d1ff0a37238a15d6b7bdd0">dircache_set_validation_params</a> (unsigned int freq, unsigned int meta_win, unsigned int meta_thresh)</td></tr>
<tr class="memdesc:aba92d20849d1ff0a37238a15d6b7bdd0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set directory cache validation parameters.  <br /></td></tr>
<tr class="memitem:aa1f0ff6827839912526bd91a7f4ff233" id="r_aa1f0ff6827839912526bd91a7f4ff233"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#aa1f0ff6827839912526bd91a7f4ff233">dircache_reset_validation_counter</a> (void)</td></tr>
<tr class="memdesc:aa1f0ff6827839912526bd91a7f4ff233"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset validation counter for consistent testing.  <br /></td></tr>
<tr class="memitem:ae62f645bef33967c49ff641fc51869ad" id="r_ae62f645bef33967c49ff641fc51869ad"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#ae62f645bef33967c49ff641fc51869ad">dircache_report_invalid_entry</a> (struct <a class="el" href="structdir.html">dir</a> *<a class="el" href="structdir.html">dir</a>)</td></tr>
<tr class="memdesc:ae62f645bef33967c49ff641fc51869ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Report that a cache entry was invalid when actually used.  <br /></td></tr>
<tr class="memitem:a2e7beceabdec9d51efb178b951ffdc7e" id="r_a2e7beceabdec9d51efb178b951ffdc7e"><td class="memItemLeft">int&#160;</td><td class="memItemRight"><a class="el" href="#a2e7beceabdec9d51efb178b951ffdc7e">dircache_remove_children</a> (const struct <a class="el" href="structvol.html">vol</a> *<a class="el" href="structvol.html">vol</a>, struct <a class="el" href="structdir.html">dir</a> *<a class="el" href="structdir.html">dir</a>)</td></tr>
<tr class="memdesc:a2e7beceabdec9d51efb178b951ffdc7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove all child entries of a directory from the dircache.  <br /></td></tr>
</table>
<a name="doc-define-members" id="doc-define-members"></a><h2 id="header-doc-define-members" class="groupheader">Macro Definition Documentation</h2>
<a id="a5705eb66727ef095a70ca709afd13e66" name="a5705eb66727ef095a70ca709afd13e66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5705eb66727ef095a70ca709afd13e66">&#9670;&#160;</a></span>DIDNAME_INDEX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DIDNAME_INDEX&#160;&#160;&#160;(1 &lt;&lt; 1)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a0790b0c7f16a543945bed231d4e6de90" name="a0790b0c7f16a543945bed231d4e6de90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0790b0c7f16a543945bed231d4e6de90">&#9670;&#160;</a></span>DIRCACHE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DIRCACHE&#160;&#160;&#160;(1 &lt;&lt; 0)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a64c15cf04a845379b849471a4099c490" name="a64c15cf04a845379b849471a4099c490"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64c15cf04a845379b849471a4099c490">&#9670;&#160;</a></span>DIRCACHE_ALL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DIRCACHE_ALL&#160;&#160;&#160;(<a class="el" href="#a0790b0c7f16a543945bed231d4e6de90">DIRCACHE</a>|<a class="el" href="#a5705eb66727ef095a70ca709afd13e66">DIDNAME_INDEX</a>|<a class="el" href="#a771f8ffab86e0a3bd7bfc0e5d37bbb43">QUEUE_INDEX</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="af4d877bd631392aad05921f5685b025a" name="af4d877bd631392aad05921f5685b025a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4d877bd631392aad05921f5685b025a">&#9670;&#160;</a></span>DIRCACHE_FREE_QUANTUM</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DIRCACHE_FREE_QUANTUM&#160;&#160;&#160;256</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aaf931e5979b4b527c20eac7b787a0774" name="aaf931e5979b4b527c20eac7b787a0774"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf931e5979b4b527c20eac7b787a0774">&#9670;&#160;</a></span>MAX_POSSIBLE_DIRCACHE_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_POSSIBLE_DIRCACHE_SIZE&#160;&#160;&#160;131072</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a771f8ffab86e0a3bd7bfc0e5d37bbb43" name="a771f8ffab86e0a3bd7bfc0e5d37bbb43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a771f8ffab86e0a3bd7bfc0e5d37bbb43">&#9670;&#160;</a></span>QUEUE_INDEX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define QUEUE_INDEX&#160;&#160;&#160;(1 &lt;&lt; 2)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="af2683959136bcfd70ba8d9157899874c" name="af2683959136bcfd70ba8d9157899874c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2683959136bcfd70ba8d9157899874c">&#9670;&#160;</a></span>dircache_add()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int dircache_add </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structvol.html">vol</a> *</td>          <td class="paramname"><span class="paramname"><em>vol</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdir.html">dir</a> *</td>          <td class="paramname"><span class="paramname"><em>dir</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>create struct dir from struct path </p>
<p>Add a struct dir to the cache and its indexes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="structvol.html">vol</a></td><td>pointer to volume </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="structdir.html">dir</a></td><td>pointer to parent directory</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on error which should result in an abort </dd></dl>

</div>
</div>
<a id="a29a3f7f19ae5e4c64e1a66ccee08eb38" name="a29a3f7f19ae5e4c64e1a66ccee08eb38"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29a3f7f19ae5e4c64e1a66ccee08eb38">&#9670;&#160;</a></span>dircache_dump()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void dircache_dump </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Dump dircache to /tmp/dircache.PID. </p>

</div>
</div>
<a id="a32d08155545949809d026537e38bc33f" name="a32d08155545949809d026537e38bc33f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32d08155545949809d026537e38bc33f">&#9670;&#160;</a></span>dircache_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int dircache_init </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>reqsize</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize the dircache and indexes. </p>
<p>This is called in child afpd initialization. The maximum cache size will be max(DEFAULT_MAX_DIRCACHE_SIZE, min(size, MAX_POSSIBLE_DIRCACHE_SIZE)). It initializes a hashtable which we use to store a directory cache in. It also initializes two indexes:</p><ul>
<li>a DID/name index on the main dircache</li>
<li>a queue index on the dircache</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">reqsize</td><td>requested maximum size from afp.conf</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on error </dd></dl>

</div>
</div>
<a id="aa87d5fbee60bed28f7c6a2858564c230" name="aa87d5fbee60bed28f7c6a2858564c230"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa87d5fbee60bed28f7c6a2858564c230">&#9670;&#160;</a></span>dircache_remove()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void dircache_remove </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structvol.html">vol</a> *</td>          <td class="paramname"><span class="paramname"><em>vol</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdir.html">dir</a> *</td>          <td class="paramname"><span class="paramname"><em>dir</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>flags</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Remove an entry from the dircache. </p>
<p>Callers outside of <a class="el" href="dircache_8c.html" title="Directory Cache.">dircache.c</a> should call this with flags = QUEUE_INDEX | DIDNAME_INDEX | DIRCACHE. </p>

</div>
</div>
<a id="a2e7beceabdec9d51efb178b951ffdc7e" name="a2e7beceabdec9d51efb178b951ffdc7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e7beceabdec9d51efb178b951ffdc7e">&#9670;&#160;</a></span>dircache_remove_children()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int dircache_remove_children </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structvol.html">vol</a> *</td>          <td class="paramname"><span class="paramname"><em>vol</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdir.html">dir</a> *</td>          <td class="paramname"><span class="paramname"><em>dir</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Remove all child entries of a directory from the dircache. </p>
<p>When a directory is renamed or moved, the full paths stored in the dircache become invalid for all child entries of the renamed dir. This function prunes orphaned child dircache entries of given dir. CNID entries use parent DIDs and name, and requre recursion to get the full path, therefore parent changes do not invalidate the CNIDs.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="structvol.html">vol</a></td><td>volume </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="structdir.html">dir</a></td><td>parent directory whose children should be removed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 if curdir was removed and recovery failed </dd></dl>

</div>
</div>
<a id="ae62f645bef33967c49ff641fc51869ad" name="ae62f645bef33967c49ff641fc51869ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae62f645bef33967c49ff641fc51869ad">&#9670;&#160;</a></span>dircache_report_invalid_entry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void dircache_report_invalid_entry </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdir.html">dir</a> *</td>          <td class="paramname"><span class="paramname"><em>dir</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Report that a cache entry was invalid when actually used. </p>
<p>This function should be called when a cached directory entry that was returned without validation (for performance) turns out to be invalid when actually accessed (e.g., file doesn't exist, has been modified, etc). This helps track the effectiveness of the validation frequency setting.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="structdir.html">dir</a></td><td>The directory entry that was found to be invalid </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa1f0ff6827839912526bd91a7f4ff233" name="aa1f0ff6827839912526bd91a7f4ff233"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1f0ff6827839912526bd91a7f4ff233">&#9670;&#160;</a></span>dircache_reset_validation_counter()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void dircache_reset_validation_counter </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reset validation counter for consistent testing. </p>
<p>Resets the global validation counter to ensure predictable validation patterns between test runs or configuration changes. </p>

</div>
</div>
<a id="a12e124fdc2f22a4a8884a55aa251b191" name="a12e124fdc2f22a4a8884a55aa251b191"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12e124fdc2f22a4a8884a55aa251b191">&#9670;&#160;</a></span>dircache_search_by_did()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdir.html">dir</a> * dircache_search_by_did </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structvol.html">vol</a> *</td>          <td class="paramname"><span class="paramname"><em>vol</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="adouble_8h.html#aef0c7a006ff504f92f04b55e14c27422">cnid_t</a></td>          <td class="paramname"><span class="paramname"><em>cnid</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Search the dircache via a CNID for a directory. </p>
<p>Found cache entries are expunged if both the parent directory st_ctime and the objects st_ctime are modified. This func builds on the fact, that all our code only ever needs to and does search the dircache by CNID expecting directories to be returned, but not files. Thus (1) if we find a file for a given CNID we (1a) remove it from the cache (1b) return NULL indicating nothing found (2) we can then use d_fullpath to stat the directory</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="structvol.html">vol</a></td><td>pointer to struct vol </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cnid</td><td>CNID of the directory to search</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to struct dir if found, else NULL </dd></dl>

</div>
</div>
<a id="a94141fa360d5c37d4390d3ede81e9fbd" name="a94141fa360d5c37d4390d3ede81e9fbd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94141fa360d5c37d4390d3ede81e9fbd">&#9670;&#160;</a></span>dircache_search_by_name()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdir.html">dir</a> * dircache_search_by_name </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structvol.html">vol</a> *</td>          <td class="paramname"><span class="paramname"><em>vol</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structdir.html">dir</a> *</td>          <td class="paramname"><span class="paramname"><em>dir</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>name</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>len</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Search the cache via did/name hashtable. </p>
<p>Found cache entries are expunged if both the parent directory st_ctime and the objects st_ctime are modified.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="structvol.html">vol</a></td><td>volume </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="structdir.html">dir</a></td><td>directory </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>name (server side encoding) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">len</td><td>strlen of name</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to struct dir if found in cache, else NULL </dd></dl>

</div>
</div>
<a id="aba92d20849d1ff0a37238a15d6b7bdd0" name="aba92d20849d1ff0a37238a15d6b7bdd0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba92d20849d1ff0a37238a15d6b7bdd0">&#9670;&#160;</a></span>dircache_set_validation_params()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int dircache_set_validation_params </td>
          <td>(</td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>freq</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>meta_win</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>meta_thresh</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set directory cache validation parameters. </p>
<p>Allows runtime configuration of cache validation behavior for performance tuning. Lower validation frequency improves performance but may delay detection of external filesystem changes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">freq</td><td>validation frequency (1 = validate every access, 5 = every 5th access) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">meta_win</td><td>metadata change time window in seconds </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">meta_thresh</td><td>metadata change threshold in seconds</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on invalid parameters </dd></dl>

</div>
</div>
<a id="a634fc2bdbe6d1b5d9def7b568faae939" name="a634fc2bdbe6d1b5d9def7b568faae939"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a634fc2bdbe6d1b5d9def7b568faae939">&#9670;&#160;</a></span>log_dircache_stat()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void log_dircache_stat </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel extern">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Log dircache statistics. </p>
<p>Includes hit ratio percentage for monitoring cache effectiveness, validation-specific metrics to monitor performance impact of the optimization changes, and username for tracking per-user stats. Shows both expunged (caught by validation) and invalid_on_use (missed by validation). </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- HTML footer for doxygen 1.14.0-->
<!-- modified for netatalk -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_34c6163d67acbbcfc56107279c411fb1.html">etc</a></li><li class="navelem"><a href="dir_785339ec9791c4184a005bb62f1723d7.html">afpd</a></li><li class="navelem"><a href="dircache_8h.html">dircache.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
</body>
</html>
