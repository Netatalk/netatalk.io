<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>netatalk: Name</title>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">netatalk<span id="projectnumber">&#160;4.4.0dev</span>
   </div>
   <div id="projectbrief">Free and Open Source Apple Filing Protocol (AFP) Server</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_manpages_2man8_2cnid__dbd_88.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Name </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md320"></a></p>
<p>cnid_dbd â€” CNID database access daemon</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md321"></a>
Synopsis</h1>
<p><b>cnid_dbd</b></p>
<p><b>cnid_dbd</b> [-v | -V]</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md322"></a>
Description</h1>
<p><b>cnid_dbd</b> provides an interface for storage and retrieval of catalog node IDs (CNIDs) and related information to the <em>afpd</em> daemon when using the <em>dbd</em> (Database Daemon) CNID backend.</p>
<p>CNIDs are a component of Classic Mac OS based file systems with semantics that does not map easily onto Unix file systems. This makes separate storage in a database necessary.</p>
<p><b>cnid_dbd</b> is never started via the command line or system startup scripts but only by the <em>cnid_metad</em> daemon. There is one instance of <b>cnid_dbd</b> per netatalk volume.</p>
<p><b>cnid_dbd</b> uses the <em>Berkeley DB</em> database library and uses transactionally protected updates. The <em>dbd</em> backend with transactions will avoid corruption of the CNID database even if the system crashes unexpectedly.</p>
<p><b>cnid_dbd</b> inherits the effective userid and groupid from <em>cnid_metad</em> on startup, which is normally caused by <em>afpd</em> serving a netatalk volume to a client. It changes to the <em>Berkeley DB</em> database home directory <em>dbdir</em> that is associated with the volume. If the userid inherited from <em>cnid_metad</em> is 0 (root), <b>cnid_dbd</b> will change userid and groupid to the owner and group of the database home directory. Otherwise, it will continue to use the inherited values. <b>cnid_dbd</b> will then attempt to open the database and start serving requests using filedescriptor <em>clntfd</em>. Subsequent instances of <em>afpd</em> that want to access the same volume are redirected to the running <b>cnid_dbd</b> process by <em>cnid_metad</em> via the filedescriptor <em>ctrlfd</em>.</p>
<p><b>cnid_dbd</b> can be configured to run forever or to exit after a period of inactivity. If <b>cnid_dbd</b> receives a TERM or an INT signal it will exit cleanly after flushing dirty database buffers to disk and closing <em>Berkeley DB</em> database environments. It is safe to terminate <b>cnid_dbd</b> this way, it will be restarted when necessary. Other signals are not handled and will cause an immediate exit, possibly leaving the CNID database in an inconsistent state (no transactions) or losing recent updates during recovery (transactions).</p>
<p>The <em>Berkeley DB</em> database subsystem will create files named log.xxxxxxxxxx in the database home directory <em>dbdir</em>, where xxxxxxxxxx is a monotonically increasing integer. These files contain the transactional database changes. They will be removed regularly, unless the <b>logfile_autoremove</b> option is specified in the <em><a class="el" href="structdb__param.html">db_param</a></em> configuration file (see below) with a value of 0 (default 1).</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md323"></a>
Options</h1>
<p><b>-v</b> | <b>-V</b></p>
<blockquote class="doxtable">
<p>Show version and exit. </p>
</blockquote>
<h1 class="doxsection"><a class="anchor" id="autotoc_md324"></a>
Configuration</h1>
<p><b>cnid_dbd</b> reads configuration information from the file <em><a class="el" href="structdb__param.html">db_param</a></em> in the database directory <em>dbdir</em> on startup. If the file does not exist or a parameter is not listed, suitable default values are used. The format for a single parameter is the parameter name, followed by one or more spaces, followed by the parameter value, followed by a newline. The following parameters are currently recognized:</p>
<p><b>logfile_autoremove</b></p>
<blockquote class="doxtable">
<p>If set to 0, unused Berkeley DB transactional logfiles (log.xxxxxxxxxx in the database home directory) are not removed on startup of <b>cnid_dbd</b> and on a regular basis. Default: 1. </p>
</blockquote>
<p><b>cachesize</b></p>
<blockquote class="doxtable">
<p>Determines the size of the Berkeley DB cache in kilobytes. Default: 8192. Each <b>cnid_dbd</b> process grabs that much memory on top of its normal memory footprint. It can be used to tune database performance. The <em>db_stat</em> utility with the <b>-m</b> option that comes with Berkeley DB can help you determine whether you need to change this value. The default is pretty conservative so that a large percentage of requests should be satisfied from the cache directly. If memory is not a bottleneck on your system you might want to leave it at that value. The <em>Berkeley DB Tutorial and Reference Guide</em> has a section <em>Selecting a cache size</em> that gives more detailed information. </p>
</blockquote>
<p><b>flush_frequency</b>; <b>flush_interval</b></p>
<blockquote class="doxtable">
<p><b>flush_frequency</b> (Default: 1000) and <b>flush_interval</b> (Default: 1800) control how often changes to the database are checkpointed. Both of these operations are performed if either i) more than <b>flush_frequency</b> requests have been received or ii) more than <b>flush_interval</b> seconds have elapsed since the last save/checkpoint. Be careful to check your hard disk configuration for on disk cache settings. Many IDE disks just cache writes as the default behaviour, so even flushing database files to disk will not have the desired effect. </p>
</blockquote>
<p><b>fd_table_size</b></p>
<blockquote class="doxtable">
<p>is the maximum number of connections (filedescriptors) that can be open for <em>afpd</em> client processes in <em>cnid_dbd.</em> Default: 512. If this number is exceeded, one of the existing connections is closed and reused. The affected <em>afpd</em> process will transparently reconnect later, which causes slight overhead. On the other hand, setting this parameter too high could affect performance in <b>cnid_dbd</b> since all descriptors have to be checked in a <em>select()</em> system call, or worse, you might exceed the per process limit of open file descriptors on your system. It is safe to set the value to 1 on volumes where only one <em>afpd</em> client process is expected to run, e.g. home directories. </p>
</blockquote>
<p><b>idle_timeout</b></p>
<blockquote class="doxtable">
<p>is the number of seconds of inactivity before an idle <b>cnid_dbd</b> exits. Default: 600. Set this to 0 to disable the timeout. </p>
</blockquote>
<h1 class="doxsection"><a class="anchor" id="autotoc_md325"></a>
Updating</h1>
<p>Starting with Netatalk 2.1.1, automatic Berkeley DB updates are supported, as long as Netatalk 2.1.0 or later was used to create the database.</p>
<p>In order to update between older Netatalk releases using different Berkeley DB library versions, follow these steps:</p>
<ul>
<li>Stop the to be upgraded old version of Netatalk</li>
<li>Using the old Berkeley DB utilities run <em>db_recover -h path/to/.AppleDB</em></li>
<li>Using the new Berkeley DB utilities run <em>db_upgrade -v -h path/to/.AppleDB -f cnid2.db</em></li>
<li>Again using the new Berkeley DB utilities run <em>db_checkpoint -1 -h path/to/.AppleDB</em></li>
<li>Start the the new version of Netatalk</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md326"></a>
See Also</h1>
<p>cnid_metad(8), afpd(8), dbd(1)</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md327"></a>
Author</h1>
<p><a href="https://netatalk.io/contributors">Contributors to the Netatalk Project</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
