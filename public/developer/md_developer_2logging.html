<!-- HTML header for doxygen 1.14.0-->
<!-- modified for netatalk -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>netatalk: Error checking and logging</title>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<script
    src="https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js"
    integrity="o+g/BxPwhi0C3RK7oQBxQuNimeafQ3GE/ST4iT2BxVI4Wzt60SH4pq9iXVYujjaS"
    crossorigin="anonymous"
></script>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectrow">
    <div id="projectlogo">
      <a href="/"><img alt="Logo" src="logo.png"/></a>
    </div>
    <div id="projectalign">
      <div id="projectname">
        netatalk
        <span id="projectnumber">&#160;4.4.0</span>
      </div>
      <div id="projectbrief">Free and Open Source Apple Filing Protocol (AFP) Server</div>
    </div>
  </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_developer_2logging.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Error checking and logging </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We want rigid error checking and concise log messages. At the same time, we want to avoid overly verbose code where the relevant function call is buried in error checking and logging statements. In order to address both error checking and code readability, we provide a set of error checking macros in &lt;<a class="el" href="errchk_8h.html" title="Error checking macros.">atalk/errchk.h</a>&gt;. Every macro comes in four flavours: EC_*CHECK*, EC_*CHECK*_LOG, EC_*CHECK*_LOGSTR and EC_*CHECK*_LOG_ERR where <em>CHECK</em> should be substituted with one of the supported tests:</p>
<ul>
<li><em>ZERO</em> - the value equals 0</li>
<li><em>NULL</em> - the value equals NULL</li>
<li><em>NEG1</em> - the value equals -1</li>
</ul>
<p>To explain the loggging logic of each error checking macro flavor, using the <em>ZERO</em> test as an example:</p>
<ul>
<li>EC_ZERO checks that the value equals 0 with a standard log message</li>
<li>EC_ZERO_LOG additionally logs the stringified function call</li>
<li>EC_ZERO_LOGSTR allows specifying an arbitrary string to log</li>
<li>EC_ZERO_LOG_ERR allows specifying the return value</li>
</ul>
<p>The macros EC_CHECK* unconditionally jump to the cleanup label defined by the <em>EC_CLEANUP</em> macro where the necessary cleanup can be done alongside validating the return value.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md40"></a>
Examples</h1>
<p>stat() without EC macro:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> func(<span class="keyword">const</span> <span class="keywordtype">char</span> *name) {</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">    ...</div>
<div class="line">    <span class="keywordflow">if</span> ((ret = stat(name, &amp;some_struct_stat)) != 0) {</div>
<div class="line">        <a class="code hl_define" href="logger_8h.html#a398fd485682fa9eab022ac4586642c09">LOG</a>(...);</div>
<div class="line">        <span class="comment">/* often needed to explicitly set the error indicating return value */</span></div>
<div class="line">        ret = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> cleanup;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line"> </div>
<div class="line">cleanup:</div>
<div class="line">    ...</div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="ttc" id="alogger_8h_html_a398fd485682fa9eab022ac4586642c09"><div class="ttname"><a href="logger_8h.html#a398fd485682fa9eab022ac4586642c09">LOG</a></div><div class="ttdeci">#define LOG(log_level, type,...)</div><div class="ttdef"><b>Definition</b> logger.h:148</div></div>
</div><!-- fragment --><p>stat() with EC macro:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> func(<span class="keyword">const</span> <span class="keywordtype">char</span> *name) {</div>
<div class="line">    <span class="comment">/* expands to int ret = 0; */</span></div>
<div class="line">    <a class="code hl_define" href="errchk_8h.html#a53f417580f8d5e89d76fffbe5ba6fd2d">EC_INIT</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> *uppername = NULL;</div>
<div class="line">    <a class="code hl_define" href="errchk_8h.html#aeccfef3dd4623c6a07f93b703adab794">EC_NULL</a>(uppername = strdup(name));</div>
<div class="line">    <a class="code hl_define" href="errchk_8h.html#a4381dbbf251f37ba9d6319b9017fa23f">EC_ZERO</a>(strtoupper(uppername));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* expands to complete if block from above */</span></div>
<div class="line">    <a class="code hl_define" href="errchk_8h.html#a4381dbbf251f37ba9d6319b9017fa23f">EC_ZERO</a>(stat(uppername, &amp;some_struct_stat));</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="errchk_8h.html#aca671a41da7f5af657ba13d33fecebe3">EC_STATUS</a>(0);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="errchk_8h.html#a208c47735e7b17af5ca81a04922369cc">EC_CLEANUP</a>:</div>
<div class="line">    <span class="keywordflow">if</span> (uppername) {</div>
<div class="line">        free(uppername);</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_define" href="errchk_8h.html#a804bc28329904e97d787e565f2b3c666">EC_EXIT</a>;</div>
<div class="line">}</div>
<div class="ttc" id="aerrchk_8h_html_a208c47735e7b17af5ca81a04922369cc"><div class="ttname"><a href="errchk_8h.html#a208c47735e7b17af5ca81a04922369cc">EC_CLEANUP</a></div><div class="ttdeci">#define EC_CLEANUP</div><div class="ttdef"><b>Definition</b> errchk.h:28</div></div>
<div class="ttc" id="aerrchk_8h_html_a4381dbbf251f37ba9d6319b9017fa23f"><div class="ttname"><a href="errchk_8h.html#a4381dbbf251f37ba9d6319b9017fa23f">EC_ZERO</a></div><div class="ttdeci">#define EC_ZERO(a)</div><div class="ttdef"><b>Definition</b> errchk.h:88</div></div>
<div class="ttc" id="aerrchk_8h_html_a53f417580f8d5e89d76fffbe5ba6fd2d"><div class="ttname"><a href="errchk_8h.html#a53f417580f8d5e89d76fffbe5ba6fd2d">EC_INIT</a></div><div class="ttdeci">#define EC_INIT</div><div class="ttdef"><b>Definition</b> errchk.h:18</div></div>
<div class="ttc" id="aerrchk_8h_html_a804bc28329904e97d787e565f2b3c666"><div class="ttname"><a href="errchk_8h.html#a804bc28329904e97d787e565f2b3c666">EC_EXIT</a></div><div class="ttdeci">#define EC_EXIT</div><div class="ttdef"><b>Definition</b> errchk.h:29</div></div>
<div class="ttc" id="aerrchk_8h_html_aca671a41da7f5af657ba13d33fecebe3"><div class="ttname"><a href="errchk_8h.html#aca671a41da7f5af657ba13d33fecebe3">EC_STATUS</a></div><div class="ttdeci">#define EC_STATUS(a)</div><div class="ttdef"><b>Definition</b> errchk.h:19</div></div>
<div class="ttc" id="aerrchk_8h_html_aeccfef3dd4623c6a07f93b703adab794"><div class="ttname"><a href="errchk_8h.html#aeccfef3dd4623c6a07f93b703adab794">EC_NULL</a></div><div class="ttdeci">#define EC_NULL(a)</div><div class="ttdef"><b>Definition</b> errchk.h:168</div></div>
</div><!-- fragment --><p>A boilerplate function template is:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> func(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="errchk_8h.html#a53f417580f8d5e89d76fffbe5ba6fd2d">EC_INIT</a>;</div>
<div class="line"> </div>
<div class="line">    ...your code here...</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="errchk_8h.html#aca671a41da7f5af657ba13d33fecebe3">EC_STATUS</a>(0);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="errchk_8h.html#a208c47735e7b17af5ca81a04922369cc">EC_CLEANUP</a>:</div>
<div class="line">    <a class="code hl_define" href="errchk_8h.html#a804bc28329904e97d787e565f2b3c666">EC_EXIT</a>;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- HTML footer for doxygen 1.14.0-->
<!-- modified for netatalk -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
