<!-- HTML header for doxygen 1.14.0-->
<!-- modified for netatalk -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>netatalk: dsi_stream.c File Reference</title>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<script
    src="https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js"
    integrity="o+g/BxPwhi0C3RK7oQBxQuNimeafQ3GE/ST4iT2BxVI4Wzt60SH4pq9iXVYujjaS"
    crossorigin="anonymous"
></script>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectrow">
    <div id="projectlogo">
      <a href="/"><img alt="Logo" src="logo.png"/></a>
    </div>
    <div id="projectalign">
      <div id="projectname">
        netatalk
        <span id="projectnumber">&#160;4.4.0</span>
      </div>
      <div id="projectbrief">Free and Open Source Apple Filing Protocol (AFP) Server</div>
    </div>
  </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('dsi__stream_8c.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">dsi_stream.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;sys/socket.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;sys/uio.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;<a class="el" href="include_2atalk_2dsi_8h_source.html">atalk/dsi.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="logger_8h_source.html">atalk/logger.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="include_2atalk_2util_8h_source.html">atalk/util.h</a>&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-define-members" class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a7b7c7e5e523ff0fc8823e7bff7665ead" id="r_a7b7c7e5e523ff0fc8823e7bff7665ead"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7b7c7e5e523ff0fc8823e7bff7665ead">MSG_MORE</a>&#160;&#160;&#160;0x8000</td></tr>
<tr class="memitem:ab18d3d439e4a9c8d0f73e7166e8eb376" id="r_ab18d3d439e4a9c8d0f73e7166e8eb376"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab18d3d439e4a9c8d0f73e7166e8eb376">MSG_DONTWAIT</a>&#160;&#160;&#160;0x40</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aacecc5ece75db48a1b99abf11287a337" id="r_aacecc5ece75db48a1b99abf11287a337"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aacecc5ece75db48a1b99abf11287a337">dsi_header_pack_reply</a> (const <a class="el" href="struct_d_s_i.html">DSI</a> *<a class="el" href="afparg_8c.html#ac4e0c8a49e10b951126073c07aa50906">dsi</a>, char *<a class="el" href="afppasswd_8c.html#a72dff57571064f4e3546a2bf18e1147d">buf</a>)</td></tr>
<tr class="memitem:a0aa521be4781a7758a104267ae14f36b" id="r_a0aa521be4781a7758a104267ae14f36b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0aa521be4781a7758a104267ae14f36b">dsi_peek</a> (<a class="el" href="struct_d_s_i.html">DSI</a> *<a class="el" href="afparg_8c.html#ac4e0c8a49e10b951126073c07aa50906">dsi</a>)</td></tr>
<tr class="memdesc:a0aa521be4781a7758a104267ae14f36b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if we can write to the <a class="el" href="struct_d_s_i.html">DSI</a> socket.  <br /></td></tr>
<tr class="memitem:a5769388f867f7f03fc9600d7836a8ded" id="r_a5769388f867f7f03fc9600d7836a8ded"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5769388f867f7f03fc9600d7836a8ded">from_buf</a> (<a class="el" href="struct_d_s_i.html">DSI</a> *<a class="el" href="afparg_8c.html#ac4e0c8a49e10b951126073c07aa50906">dsi</a>, uint8_t *<a class="el" href="afppasswd_8c.html#a72dff57571064f4e3546a2bf18e1147d">buf</a>, size_t count)</td></tr>
<tr class="memitem:a8ded949de30884027fa9785521848b0c" id="r_a8ded949de30884027fa9785521848b0c"><td class="memItemLeft" align="right" valign="top">static ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8ded949de30884027fa9785521848b0c">buf_read</a> (<a class="el" href="struct_d_s_i.html">DSI</a> *<a class="el" href="afparg_8c.html#ac4e0c8a49e10b951126073c07aa50906">dsi</a>, uint8_t *<a class="el" href="afppasswd_8c.html#a72dff57571064f4e3546a2bf18e1147d">buf</a>, size_t count)</td></tr>
<tr class="memdesc:a8ded949de30884027fa9785521848b0c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get bytes from buffer dsi-&gt;buffer or read from socket.  <br /></td></tr>
<tr class="memitem:a6cfb2429545b304c2840ba614420f089" id="r_a6cfb2429545b304c2840ba614420f089"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6cfb2429545b304c2840ba614420f089">dsi_buffered_stream_read</a> (<a class="el" href="struct_d_s_i.html">DSI</a> *<a class="el" href="afparg_8c.html#ac4e0c8a49e10b951126073c07aa50906">dsi</a>, uint8_t *<a class="el" href="hash_8c.html#a43a278d13284fb3412e9eee1db1d967e">data</a>, const size_t length)</td></tr>
<tr class="memdesc:a6cfb2429545b304c2840ba614420f089"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get "length" bytes from buffer and/or socket.  <br /></td></tr>
<tr class="memitem:a4e7d4bcf6c6dc6a05bb88c0e65ae797a" id="r_a4e7d4bcf6c6dc6a05bb88c0e65ae797a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4e7d4bcf6c6dc6a05bb88c0e65ae797a">block_sig</a> (<a class="el" href="struct_d_s_i.html">DSI</a> *<a class="el" href="afparg_8c.html#ac4e0c8a49e10b951126073c07aa50906">dsi</a>)</td></tr>
<tr class="memitem:aed33cc3def8ce154445ac8f0b44160ac" id="r_aed33cc3def8ce154445ac8f0b44160ac"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aed33cc3def8ce154445ac8f0b44160ac">unblock_sig</a> (<a class="el" href="struct_d_s_i.html">DSI</a> *<a class="el" href="afparg_8c.html#ac4e0c8a49e10b951126073c07aa50906">dsi</a>)</td></tr>
<tr class="memitem:a9b5a0094ceb62bf133a685a2007c2149" id="r_a9b5a0094ceb62bf133a685a2007c2149"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9b5a0094ceb62bf133a685a2007c2149">dsi_disconnect</a> (<a class="el" href="struct_d_s_i.html">DSI</a> *<a class="el" href="afparg_8c.html#ac4e0c8a49e10b951126073c07aa50906">dsi</a>)</td></tr>
<tr class="memdesc:a9b5a0094ceb62bf133a685a2007c2149"><td class="mdescLeft">&#160;</td><td class="mdescRight">Communication error with the client, enter disconnected state.  <br /></td></tr>
<tr class="memitem:a94bd186e5b2b5777dc8a884659b96f9d" id="r_a94bd186e5b2b5777dc8a884659b96f9d"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a94bd186e5b2b5777dc8a884659b96f9d">dsi_stream_write</a> (<a class="el" href="struct_d_s_i.html">DSI</a> *<a class="el" href="afparg_8c.html#ac4e0c8a49e10b951126073c07aa50906">dsi</a>, void *<a class="el" href="hash_8c.html#a43a278d13284fb3412e9eee1db1d967e">data</a>, const size_t length, int mode)</td></tr>
<tr class="memdesc:a94bd186e5b2b5777dc8a884659b96f9d"><td class="mdescLeft">&#160;</td><td class="mdescRight">write raw <a class="el" href="struct_d_s_i.html">DSI</a> data  <br /></td></tr>
<tr class="memitem:a787fa415b687859a14a661c5450c8475" id="r_a787fa415b687859a14a661c5450c8475"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a787fa415b687859a14a661c5450c8475">dsi_stream_read_file</a> (<a class="el" href="struct_d_s_i.html">DSI</a> *<a class="el" href="afparg_8c.html#ac4e0c8a49e10b951126073c07aa50906">dsi</a>, const int fromfd, off_t offset, const size_t length, const int err)</td></tr>
<tr class="memitem:a91514f1127598ab63de788766e64c32f" id="r_a91514f1127598ab63de788766e64c32f"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a91514f1127598ab63de788766e64c32f">dsi_stream_read</a> (<a class="el" href="struct_d_s_i.html">DSI</a> *<a class="el" href="afparg_8c.html#ac4e0c8a49e10b951126073c07aa50906">dsi</a>, void *<a class="el" href="hash_8c.html#a43a278d13284fb3412e9eee1db1d967e">data</a>, const size_t length)</td></tr>
<tr class="memdesc:a91514f1127598ab63de788766e64c32f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read data from <a class="el" href="struct_d_s_i.html">DSI</a> buffer.  <br /></td></tr>
<tr class="memitem:ac39b4c877c87a570a425d15dbf5e0c39" id="r_ac39b4c877c87a570a425d15dbf5e0c39"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac39b4c877c87a570a425d15dbf5e0c39">dsi_stream_send</a> (<a class="el" href="struct_d_s_i.html">DSI</a> *<a class="el" href="afparg_8c.html#ac4e0c8a49e10b951126073c07aa50906">dsi</a>, void *<a class="el" href="afppasswd_8c.html#a72dff57571064f4e3546a2bf18e1147d">buf</a>, size_t length)</td></tr>
<tr class="memdesc:ac39b4c877c87a570a425d15dbf5e0c39"><td class="mdescLeft">&#160;</td><td class="mdescRight">write data.  <br /></td></tr>
<tr class="memitem:a3b03a8898f3d8c9e2781cee5c92a5c07" id="r_a3b03a8898f3d8c9e2781cee5c92a5c07"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3b03a8898f3d8c9e2781cee5c92a5c07">dsi_stream_receive</a> (<a class="el" href="struct_d_s_i.html">DSI</a> *<a class="el" href="afparg_8c.html#ac4e0c8a49e10b951126073c07aa50906">dsi</a>)</td></tr>
<tr class="memdesc:a3b03a8898f3d8c9e2781cee5c92a5c07"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read <a class="el" href="struct_d_s_i.html">DSI</a> command and data.  <br /></td></tr>
</table>
<a name="doc-define-members" id="doc-define-members"></a><h2 id="header-doc-define-members" class="groupheader">Macro Definition Documentation</h2>
<a id="ab18d3d439e4a9c8d0f73e7166e8eb376" name="ab18d3d439e4a9c8d0f73e7166e8eb376"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab18d3d439e4a9c8d0f73e7166e8eb376">&#9670;&#160;</a></span>MSG_DONTWAIT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MSG_DONTWAIT&#160;&#160;&#160;0x40</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7b7c7e5e523ff0fc8823e7bff7665ead" name="a7b7c7e5e523ff0fc8823e7bff7665ead"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b7c7e5e523ff0fc8823e7bff7665ead">&#9670;&#160;</a></span>MSG_MORE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MSG_MORE&#160;&#160;&#160;0x8000</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="a4e7d4bcf6c6dc6a05bb88c0e65ae797a" name="a4e7d4bcf6c6dc6a05bb88c0e65ae797a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e7d4bcf6c6dc6a05bb88c0e65ae797a">&#9670;&#160;</a></span>block_sig()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void block_sig </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_d_s_i.html">DSI</a> *</td>          <td class="paramname"><span class="paramname"><em>dsi</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a8ded949de30884027fa9785521848b0c" name="a8ded949de30884027fa9785521848b0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ded949de30884027fa9785521848b0c">&#9670;&#160;</a></span>buf_read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t buf_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_d_s_i.html">DSI</a> *</td>          <td class="paramname"><span class="paramname"><em>dsi</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>count</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get bytes from buffer dsi-&gt;buffer or read from socket. </p>
<ol type="1">
<li>Check if there are bytes in the the dsi-&gt;buffer buffer.</li>
<li>Return bytes from (1) if yes. Note: this may return fewer bytes then requested in count !!</li>
<li>If the buffer was empty, read from the socket. </li>
</ol>

</div>
</div>
<a id="a6cfb2429545b304c2840ba614420f089" name="a6cfb2429545b304c2840ba614420f089"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6cfb2429545b304c2840ba614420f089">&#9670;&#160;</a></span>dsi_buffered_stream_read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t dsi_buffered_stream_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_d_s_i.html">DSI</a> *</td>          <td class="paramname"><span class="paramname"><em>dsi</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>data</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t</td>          <td class="paramname"><span class="paramname"><em>length</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get "length" bytes from buffer and/or socket. </p>
<p>In order to avoid frequent small reads this tries to read larger chunks (8192 bytes) into a buffer. </p>

</div>
</div>
<a id="a9b5a0094ceb62bf133a685a2007c2149" name="a9b5a0094ceb62bf133a685a2007c2149"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b5a0094ceb62bf133a685a2007c2149">&#9670;&#160;</a></span>dsi_disconnect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dsi_disconnect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_d_s_i.html">DSI</a> *</td>          <td class="paramname"><span class="paramname"><em>dsi</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Communication error with the client, enter disconnected state. </p>
<ol type="1">
<li>close the socket</li>
<li>set the DSI_DISCONNECTED flag, remove possible sleep flags</li>
</ol>
<dl class="section return"><dt>Returns</dt><dd>0 if successfully entered disconnected state </dd>
<dd>
-1 if ppid is 1 which means afpd master died, or euid == 0 i.e. where still running as root (unauthenticated session) </dd></dl>

</div>
</div>
<a id="aacecc5ece75db48a1b99abf11287a337" name="aacecc5ece75db48a1b99abf11287a337"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacecc5ece75db48a1b99abf11287a337">&#9670;&#160;</a></span>dsi_header_pack_reply()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void dsi_header_pack_reply </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_d_s_i.html">DSI</a> *</td>          <td class="paramname"><span class="paramname"><em>dsi</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Pack a <a class="el" href="struct_d_s_i.html">DSI</a> header in wire format </p>

</div>
</div>
<a id="a0aa521be4781a7758a104267ae14f36b" name="a0aa521be4781a7758a104267ae14f36b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0aa521be4781a7758a104267ae14f36b">&#9670;&#160;</a></span>dsi_peek()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int dsi_peek </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_d_s_i.html">DSI</a> *</td>          <td class="paramname"><span class="paramname"><em>dsi</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if we can write to the <a class="el" href="struct_d_s_i.html">DSI</a> socket. </p>
<p>afpd is sleeping too much while trying to send something. May be there's no reader or the reader is also sleeping in write, look if there's some data for us to read, hopefully it will wake up the reader so we can write again.</p>
<dl class="section return"><dt>Returns</dt><dd>0 when is possible to send again, -1 on error </dd></dl>

</div>
</div>
<a id="a91514f1127598ab63de788766e64c32f" name="a91514f1127598ab63de788766e64c32f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91514f1127598ab63de788766e64c32f">&#9670;&#160;</a></span>dsi_stream_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t dsi_stream_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_d_s_i.html">DSI</a> *</td>          <td class="paramname"><span class="paramname"><em>dsi</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>data</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t</td>          <td class="paramname"><span class="paramname"><em>length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read data from <a class="el" href="struct_d_s_i.html">DSI</a> buffer. </p>
<p>Essentially a loop around <a class="el" href="#a8ded949de30884027fa9785521848b0c" title="Get bytes from buffer dsi-&gt;buffer or read from socket.">buf_read()</a> to ensure "length" bytes are read from dsi-&gt;buffer and/or the socket.</p>
<dl class="section return"><dt>Returns</dt><dd>length on success, some value smaller than length indicates an error </dd></dl>

</div>
</div>
<a id="a787fa415b687859a14a661c5450c8475" name="a787fa415b687859a14a661c5450c8475"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a787fa415b687859a14a661c5450c8475">&#9670;&#160;</a></span>dsi_stream_read_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t dsi_stream_read_file </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_d_s_i.html">DSI</a> *</td>          <td class="paramname"><span class="paramname"><em>dsi</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int</td>          <td class="paramname"><span class="paramname"><em>fromfd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">off_t</td>          <td class="paramname"><span class="paramname"><em>offset</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t</td>          <td class="paramname"><span class="paramname"><em>length</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int</td>          <td class="paramname"><span class="paramname"><em>err</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a3b03a8898f3d8c9e2781cee5c92a5c07" name="a3b03a8898f3d8c9e2781cee5c92a5c07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b03a8898f3d8c9e2781cee5c92a5c07">&#9670;&#160;</a></span>dsi_stream_receive()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dsi_stream_receive </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_d_s_i.html">DSI</a> *</td>          <td class="paramname"><span class="paramname"><em>dsi</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read <a class="el" href="struct_d_s_i.html">DSI</a> command and data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dsi</td><td>(rw) <a class="el" href="struct_d_s_i.html">DSI</a> handle</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="struct_d_s_i.html">DSI</a> function on success, 0 on failure </dd></dl>

</div>
</div>
<a id="ac39b4c877c87a570a425d15dbf5e0c39" name="ac39b4c877c87a570a425d15dbf5e0c39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac39b4c877c87a570a425d15dbf5e0c39">&#9670;&#160;</a></span>dsi_stream_send()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dsi_stream_send </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_d_s_i.html">DSI</a> *</td>          <td class="paramname"><span class="paramname"><em>dsi</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>write data. </p>
<dl class="section return"><dt>Returns</dt><dd>0 on failure. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>this assumes that dsi_len will never cause an overflow in the data buffer. </dd></dl>

</div>
</div>
<a id="a94bd186e5b2b5777dc8a884659b96f9d" name="a94bd186e5b2b5777dc8a884659b96f9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94bd186e5b2b5777dc8a884659b96f9d">&#9670;&#160;</a></span>dsi_stream_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t dsi_stream_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_d_s_i.html">DSI</a> *</td>          <td class="paramname"><span class="paramname"><em>dsi</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>data</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t</td>          <td class="paramname"><span class="paramname"><em>length</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>mode</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>write raw <a class="el" href="struct_d_s_i.html">DSI</a> data </p>
<p>Checks against EINTR aren't necessary if all of the signals have SA_RESTART specified.</p>
<dl class="section return"><dt>Returns</dt><dd>actual bytes written, -1 on error </dd></dl>

</div>
</div>
<a id="a5769388f867f7f03fc9600d7836a8ded" name="a5769388f867f7f03fc9600d7836a8ded"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5769388f867f7f03fc9600d7836a8ded">&#9670;&#160;</a></span>from_buf()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t from_buf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_d_s_i.html">DSI</a> *</td>          <td class="paramname"><span class="paramname"><em>dsi</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>buf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>count</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return all bytes up to count from dsi-&gt;buffer if there are any buffered there </p>

</div>
</div>
<a id="aed33cc3def8ce154445ac8f0b44160ac" name="aed33cc3def8ce154445ac8f0b44160ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed33cc3def8ce154445ac8f0b44160ac">&#9670;&#160;</a></span>unblock_sig()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void unblock_sig </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_d_s_i.html">DSI</a> *</td>          <td class="paramname"><span class="paramname"><em>dsi</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- HTML footer for doxygen 1.14.0-->
<!-- modified for netatalk -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_f7a34ca911643fbe46878d1e60e6cd22.html">libatalk</a></li><li class="navelem"><a href="dir_3af8ef1224ddda9ea239d7a932a15df7.html">dsi</a></li><li class="navelem"><a href="dsi__stream_8c.html">dsi_stream.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
